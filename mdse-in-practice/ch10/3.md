## 10.3 模型比较

#### ▶[上一节](2.md)

检测模型间的差异是模型管理中至关重要的操作。理解两个模型之间的差异，与理解两个基于文本的工件之间的差异同样必要。除人工理解外，模型差异还是自动化模型管理活动的必要输入，例如元模型/模型协同演化（参见第 [10.5](5.md) 节）或模型版本控制（参见第 [10.4](4.md) 节）。这些任务基于所谓的 *差异模型 (difference models)* —— 顾名思义，这类模型用于描述两个模型间的差异点。生成差异模型是模型比较工具的职责，该工具以两个模型为输入，计算出差异模型作为输出。

模型比较采用两阶段流程实现 [12](../bibliography.md#12) ：首先，需进行模型匹配，即标记两个版本中对应的元素；其次，基于匹配结果推导差异。

**第一阶段：模型匹配** 。匹配两个模型元素意味着对其 *身份 (identity)* 进行推理。具有相同身份的模型元素被视为匹配。存在多种匹配策略，它们利用模型元素的不同特征来确定 (establish) 其身份。Kolovos等人[46](../bibliography.md#46) 将匹配策略分为基于静态身份的匹配、基于签名的匹配、基于相似性的匹配以及特定语言的匹配。静态身份匹配依赖于为每个模型元素附加的人工唯一标识符，而签名匹配则基于特征值的计算组合比对模型元素。这两类方法均以二元方式 (dually) 处理模型匹配问题，即两个模型元素要么匹配要么不匹配。相比之下，相似度匹配基于名称等价性或结构等价性（如输入/输出链接）计算模型元素间的相似度度量。最后，语言特异性匹配要求我们制定专用匹配规则，从而能够考虑建模语言的底层语义。

**第二阶段：模型差异分析** 。差异算法对（第一阶段匹配）对应的两个模型元素进行精细化比较。若两个对应元素存在差异，则生成差异描述并添加至差异模型。现有模型比较方法能够检测到与原子操作（即添加、删除、移动和更新）应用相对应的差异。例如，若某模型元素在另一侧无对应元素（即该元素未匹配），则记录元素插入或删除操作 —— 这里取决于将哪个模型视为初始模型，哪个模型视为修订模型。

针对 EMF 模型，现有多种模型比较工具与框架：

- **EMF Compare** <sup>[12](0.md#12)</sup> 是 Eclipse 项目，为各类 EMF 模型提供通用比较功能（亦可针对不同 EMF 模型类型定制比较算法）。两个模型之间的计算差异能够可视化呈现，并能以模型补丁的形式导出，其功能类似于程序补丁。图形化图示的比较支持正在开发中。
- **SiDiff** <sup>[13](0.md#13)</sup>  采用元模型无关的比较方法，核心基于模型元素相似性概念，同时支持 (cover) 其他方法，如基于身份或基于签名的模型比较。其主要优势在于提供高度可配置的环境，能轻松适配任何（可通过图结构表示的）建模语言。
- **Epsilon 比较语言** <sup>[14](0.md#14)</sup>（Epsilon Comparison Language, ECL）通过专用 DSL 实现特殊化比较算法，可检测超越原子变更的高阶变更，如重构。ECL 能比较遵循不同元模型的双模型，例如，可以开发基于 ECL 的比较支持功能，用于将 UML 类图与实体关系图 (Entity Relationship diagram) 进行对比。

#### ▶[下一节](4.md)
