## 9.5 附记：通过 M2M 转换与 TCS 实现代码生成

#### ▶[上一节](4.md)

若M2T转换的目标语言已由元模型和TCS支持（该TCS可实现模型与文本间的解析/序列化），则可改用M2M转换来实现M2T转换。图9.5展示了采用此方法的转换流程：首先将建模语言的元模型转换为基于文本的语言元模型，随后根据抽象语法与TCS的映射关系，将生成的目标模型序列化为文本。

#### Fig 9.5
![Fig 9.5](../img/fig9.5.png)

*Fig 9.5: 基于TCS的代码生成*

该方法初看颇具优势：(i) 重用文本具体语法定义可确保生成有效文本构件；(ii) 文本语言的显式元模型有助于更清晰地阐释语言概念及建模语言到文本语言的映射关系； (iii) 可基于元模型验证转换规则；(iv) 输出文本构件的模型可参照目标元模型进行验证；(v) 目标语言的具体语法变更与双向转换机制无关，无需额外维护代码生成器。

然而该方法也存在当前局限性。现有的编程语言元模型大多缺乏TCS定义，更严重的是某些语言根本不存在元模型或其规范不完整。另一缺陷在于文本型语言仅通过其TCS定义呈现。因此在抽象语法层面对语言概念进行推理可能需要学习成本，而使用代码生成模板时则无需此过程。该方法无法像M2T转换那样通过复制代码并替换元标记实现从参考代码到转换定义的抽象化。此外，部分代码生成场景所需的功能（如受保护区域）未被涵盖。最后，代码生成器可能仅需目标语言的有限子集，采用M2T转换语言实现此需求远比推导完整目标语言定义更为简便。

综上所述，尽管将M2T转换简化为M2M转换存在某些优势，但从实用角度看，采用M2T转换语言构建代码生成器更为便捷——尤其当目标语言缺乏元模型和TCS定义时。因此，仅当目标语言已具备元模型与TCS支持，且采用完整代码生成方案时，才应考虑采用M2M/TCS方法进行代码生成。

#### ▶[下一节](../ch10/0.md)
