## 聚合体: Aggregates

#### ▶[上一节](6.md)

在具有复杂关联的模型中，很难保证对象变更的一致性。对象应该保持自身内部状态的一致性，但它们可能会受到其他概念上属于其组成部分的对象变更的影响。谨慎的数据库锁定方案可能导致多个用户无意义地互相干扰，从而使系统无法使用。当将对象分布到多个服务器或设计异步事务时，也会出现类似的问题。

因此：

<ins>**将 [Entities](2.md) 和 [Value Objects](3.md) 聚合成聚合体，并为每个其定义边界。选择一个 [Entity](2.md) 作为每个聚合体的根，并允许外部对象仅持有对根的引用（对内部成员的引用仅在单个操作中传出使用）。为整个聚合体定义属性和不变量，并将执行责任赋予根或某个指定的框架机制。**</ins>

使用相同的聚合边界来管理交易 (transactions) 和分布 (distribution)。

在聚合边界内，应用一致性规则同步执行。在边界之间，异步处理更新。

将一个聚合保持在一台服务器上。允许不同的聚合分布在不同的节点上。

当这些设计决策没有很好地受到聚合边界的指导时，应重新考虑模型。领域场景是否暗示了一个重要的新见解？这样的变化通常可以提高模型的表达能力和灵活性，同时解决事务和分布问题。

#### ▶[下一节](8.md)
