## 18.3 质量
到目前为止，我们一直把重点完全放在如何提高软件开发的效率上，但质量也同样重要，尤其是因为它的长期影响。本节将探讨影响软件质量的一些因素及其与 MDSD 的关系。

### 18.3.1 定义良好的架构
只有系统地定义了模型中特定概念与实现代码之间的映射关系（即基于明确定义的规 则），才能合理地使用代码生成。首先必须定义这些规则。为了减少对代码生成的需求，我们建议使用一套尽可能小且定义明确的规则。一小套定义明确的概念和实施习惯用法是良好架构的标志。我们的结论是，就 MDSD 而言，平台架构和平台上应用功能的实现都必须经过周密的规划。MDSD 需要一个简洁、定义明确的架构。尽管模型的抽象程度较高，但这将导致模型与实现之间的永久一致性。适当的生成技术可以在强烈的迭代开发过程中保证这种一致性（见第 3 章）。

### 18.3.2 保存专家知识
建模语言、生成器和平台构成了特定领域的可重用软件生产线。当今的技术平台，如 J2EE、.NET 或 CORBA，都为各自的应用领域提供了大量的基本服务，例如 J2EE 就适用于大型企业应用。然而，高效地使用这些服务--以及平台本身--并不容易。我们必须遵守特定的模式或习惯用语，才能充分挖掘平台的潜力：必须 “正确” 使用平台。当然，所有的模式和惯用语都已记录在案，原则上也是众所周知的，但在大型项目中，如何确保团队成员（他们的资质通常差别很大）最终应用正确的模式，却是一个大问题。MDSD 可以在这方面提供帮助，因为已定义的领域概念总是以相同的方式在平台上自动实现。因此，转换是可通过机器处理的设计知识。它们具有固有的价值，因为它们保留了在各自领域背景下如何有效使用平台的知识。

### 18.3.3 严格的编程模型
在当今的实践中，100% 生成应用程序代码是不合理的。通常会生成一个骨架，开发人员在其中添加手写的应用程序代码。平台架构和生成的应用程序骨架决定了必须在哪里、如何集成手工创建的代码，以及这些代码的结构方式。这就为开发人员提供了一种保障，使他们不太可能创建 “一团糟” 的系统。

### 18.3.4 最新且可用的文档
在 “传统” 软件开发中，应用逻辑与技术代码混合在一起，通常使用 3GL 语言针对特定平台进行编程。在处理 EJB 等技术时，应用服务器会接管特定的技术服务，如事务或安全，尽管程度较低，但也会这样做。由于许多概念在这一抽象层次上是不可见的，因此必须使用各种方法对软件进行文档化。在时间紧迫的项目中，这些文档往往无法与代码保持同步，因此，如果时间开始耗尽，文档通常是第一个受害者。

就 MDSD 而言，情况则完全不同：各种工件构成了系统特定方面的正式文档：

- 特定领域模型提供了一个极好的概览，因为反复出现的实现模式和细节都是从模型中分解出来的。因此，它比实现模型要紧凑得多。
- DSL 和转换记录了平台的使用和模型的语义。
- 模型以领域专家可以理解的形式记录应用结构和逻辑。除了模型本身，用户手册和其他文档也可以从应用模型及其描述中生成。生成式创建可确保文档在首次发布后与代码库保持一致。

这些工件始终与实际应用程序同步，因为它们是应用程序生成的源头。

当然，MDSD 也需要非正式的文档。DSL 及其语义必须记录在案，以便在项目中有效使用。不过，这种文档只需要为每个 DSL 编写一次，而不是为每个应用程序编写（见第 18.4 节）。

### 18.3.5 生成代码的质量
一般来说，生成代码的名声很不好：几乎不可读、没有文档记录、性能很差。然而，在 MDSD 中，这种偏见是没有根据的，因为生成代码的质量直接取决于转换（例如模板）。后者通常来自参考实现（见第 13.2.2 节）。这意味着上述特性（如可读性和性能）会从参考实现传播到生成的应用程序中。

这也是为什么要特别开发和维护参考实现的原因。只要在创建转换时足够谨慎，生成代码的质量就不会比手工创建的代码差。相反，生成的代码通常比手工创建的代码更系统、更一致，因为重复的部分总是由同一个生成器生成，所以它们的外观和工作方式总是相同的。

例如，使用现在的生成器，合理缩进代码不成问题。注释也可以轻松生成。我们应该注意这些事项--开发人员会感激不尽的。

### 18.3.6 测试工作和可能的错误来源
使用 MDSD 时，许多方面都会对所生成软件的错误率产生积极影响。这在第一个 MDSD 项目中就可以看到，但主要是在后续项目和维护过程中才能感受到：

- 通过使用生成法生成测试脚本和测试数据，MDSD有助于实现测试自动化（参见第14章）。
- 以转换（或模板）的形式对示意代码进行概括，可以采用一种新的方法来验证应用程序架构的可扩展性、性能和不寻常应用程序结构的覆盖范围。只需花费很少的精力，就能生成一个比人工开发的参考实现更具通用性的测试应用程序，并能覆盖架构适用性的极端情况。因此，可以及早发现架构中的薄弱环节，并通过改进参考实施和模板来加以解决。这对项目的风险状况产生了积极影响，并表明 MDSD 可以合理地应用于高风险项目。
- 使用生成式测试应用程序进行的广泛测试，可省去一整类测试，否则每一个生成的应用程序都需要进行测试。
- 由于可生成的代码通常占整个代码量的 50%以上，因此通过自动化可大大减少潜在的错误源。从长远来看，MDSD 在质量方面的优势与生产率的提高同样重要。
- 可以根据应用模型元素的描述和特征来生成用户手册和其他文档。生成式创建可确保文档在首次发布后与代码库保持一致。
