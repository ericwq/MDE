## 7.6 平衡 MDSD 平台
就 MDSD 而言，参考模型非常重要--它不仅用于构建目标体系结构，还特别用于定义 MDSD 平台的边界，而 MDSD 平台是目标体系结构的一部分。最后，应用模型必须通过转换映射到 MDSD 平台，以便使其可执行。MDSD 领域的概念与 MDSD 平台的概念之间的差异越大，所需的转换就越复杂。这种情况应该避免，特别是因为元层面的复杂性比目标架构具体层面的复杂性更难处理。为了降低复杂性，MDSD 领域和 MDSD 平台应尽可能地相互接近--更确切地说，MDSD 平台应 “以一半的方式满足 MDSD 领域”。我们也称这样的平台为丰富的特定领域平台。

就参考模型而言，我们现在有几种基本方案来缩小领域和平台之间的概念距离：

- MDSD 领域和平台位于参考模型技术平台的层次上。例如，这将导致选择 J2EE 作为 DSL 的 UML 配置文件和 J2EE 作为 MDSD 平台。这样的领域架构当然是可行的，但由于其抽象程度有限，它不能充分发挥自动化的潜力：建模应用程序的大部分必须手动编程。另一方面，MDSD 领域具有很强的通用性--该领域架构允许生产非常不同的应用程序。
- MDSD 领域和平台处于目标架构概念的层面。第 3 章案例研究中的 AC- MDSD 就是一个例子。这里，功能平台的架构实现模式来自 DSL 定义的参考模型以及 MDSD 平台。在这种情况下，领域的通用性较低，但其抽象程度提高了，因此自动化的潜力也更大。
- MDSD 领域和平台处于参考架构的功能/专业平台级别。在这种情况下，参考架构的功能/专业平台成为 MDSD 平台。与以体系结构为中心的情况相比，领域的通用性明显降低，但自动化程度可以达到 100%。

我们推荐后两种方案，甚至是两种方案的叠加，即在以架构为中心的领域架构之上创建功能/专业 MDSD 平台。第 16 章中的案例研究对这种方法进行了说明。

### 7.6.1 示例
在实践中，MDSD 平台的边界在哪里，以及在每个特定情况下的边界在哪里，通常取决于在具体情况下需要多大的灵活性。下面是一些例子：

- 以架构为中心的 MDSD 电子商务系统平台的典型要素包括流程控制或工作流引擎、持久性框架、图形用户界面、活动和实体的超类等，以及 J2EE 容器和关系数据库等技术标准基础设施。以架构为中心的 MDSD 领域的每个软件系统的所有这些工件都是相同的。
- 在天文学领域的射电望远镜系统族中，恒星、星系或行星都是相关实体。它们的属性通常变化不大，因此这些实体是 MDSD 平台的一部分。此外，在这种情况下，许多 “业务规则 ”都是静态的，因为它们是基于物理定律的。
- 对于保险公司来说，保险产品是相关实体。这些产品实际上是非常不同的，而且经常变化。使用 DSL 可以方便地描述这些实体，并生成它们的实现。其他核心实体，如 “人”（Person）或 “账户”（Account），也可以成为 MDSD 平台的一部分。
- 在分布式嵌入式系统组件基础架构的背景下，即使是技术平台，即中间件，也是根据预定义的系统约束和拓扑定义生成的，因此不属于 MDSD 平台的一部分。即使生成了所有基本实体或技术基础架构，特定领域的基本框架通常也是 MDSD 平台的一部分。例如，在嵌入式系统中，我们可能会发现总线驱动器和编码器来序列化数据结构，以便在网络上传输。

我们建议您在项目实施过程中，随着对领域理解的加深，逐步扩展 MDSD 平台的功能。这将减少开发人员为定制框架而编写代码的范围和复杂性，因为这些代码必须是生成的，甚至部分必须手动编写。

一般来说，通用和可通用的代码段应成为 MDSD 平台的一部分。现有的框架通常也非常适合集成到 MDSD 平台中。

### 7.6.2 整合框架
通过使用定制的 DSL，可以大大简化和加快复杂框架的使用。框架纯粹主义者往往忽视了这一点。在许多情况下，只有 DSL 和模型驱动方法才能保证框架的正确使用，也就是框架发明者的意图。当今的实现语言并不具备任何特别强大的机制来防止框架的错误使用。根据框架的定义，框架的实现与框架的使用之间存在紧密的互锁关系，这往往与封装原则相矛盾。只有通过 DSL 才能将领域与应用的实现平台明确隔离。

另一方面，可配置性高的通用框架也有可能造成实现负担过重，难以维护和调试。在构建 MDSD 平台时应考虑到这一点。

成功设计 MDSD 平台的关键在于迭代、渐进的方法，第 13 章对此进行了介绍。在大型独立项目中开发功能强大的框架，与实际应用开发项目没有直接的迭代联系，将不可避免地导致失败。相反，小型框架与代码生成相结合，为迭代开发奠定了坚实的基础。当代码生成（即编写模板）变得过于困难时，就值得加强框架并在其帮助下实现更多功能。反之亦然，如果框架的实现变得过于复杂，或其运行性能下降，那么使用生成技术往往会带来重要的解决方案。
