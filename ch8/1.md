## 8.1 DSL 构建
本节包含一些有关构建 DSL 本身的提示。请注意，除了本节列出的项目外，您还可以在全书中找到大量 DSL 示例。构建 DSL 的一个重要因素当然是元建模，第 6 章已对此进行详细介绍。

### 8.1.1 选择合适的 DSL
在为某个领域寻找 DSL 时，应始终考虑到所需表达的可变性。因此，在开始使用完全成熟的、类似于图形的文本或图形 DSL 之前，先问问自己较简单的 DSL 形式是否足够。图 8.1 显示了根据 Krzysztof Czarnecki 的著作改编的替代方案。

![Figure 8.1](../img/f8.1.png)

如果只需要进行常规配置，那么简单的属性文件或向导可能就足以表达描述产品所需的可变性。如果您需要更大的自由度--您必须从中选择的可变性空间更大--那么基于表格或树形的配置就更合适了，特征模型（第 13.5.3 节）是主要采用面向配置方法的 DSL 中最强大的。到此为止，使用 DSL 基本上就是从一些选项中进行选择，也就是配置工作。

如果这还不够，您还必须采用一种创造性的建模方法，即使用功能强大的图形或文本语言，创造性地实例化、排列和连接 DSL 中可用的建模元素。这种方法当然功能强大得多，但为开发人员提供的指导也少得多。如果需要表达结构上的可变性，尤其是 “我需要一个 A 类型连接到这个 B 类型的实例，然后我还需要三个 C 类型的实例”，那么面向配置的方法很快就会变得笨拙，您必须重新采用创造性的构建方法。

通常情况下，你会使用这些 DSL 的组合来描述一个完整的系统。例如，在第 16.3.3 节的案例研究中，我们使用基于图形和 XML 的类图语言来定义系统结构，但使用从特征模型导出的简单配置参数来描述通信特征。

请注意，在图 8.1 中类图语言的右侧是框架，一般来说是手动编程。它们提供了最大的自由度和灵活性，但也需要最大的努力，提供最少的指导，因此是最复杂的方法。

### 8.1.2 配置和构造--变体
我们现在可以看到两种 “类型 ”的 DSL：支持创造性构造的 DSL 和提供配置手段的 DSL。将两者结合起来是非常有趣的。请看图 8.2 中的元模型，它是描述数据结构的创造性构造 DSL 的基础。

![Figure 8.2](../img/f8.2.png)

使用这个元模型，你可以定义各种数据结构，如图 8.3 中定义的数据结构。

![Figure 8.3](../img/f8.3.png)

