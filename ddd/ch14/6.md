## 客户/供应商开发团队：`CUSTOMER/SUPPLIER DEVELOPMENT TEAMS`

#### ▶[上一节](5.md)

<img src="../img/part4.6.png" width="80%" /></br>

通常一个子系统本质上为另一个子系统提供支持；“下游” 组件执行分析或其他功能，但几乎不会向 “上游” 组件提供反馈，所有依赖关系都是单向的。这两个子系统通常服务于截然不同的用户群体，这些用户从事不同工作，需要不同的模型。工具集也可能不同，因此程序代码无法共享。

🌼🌼🌼

上游和下游子系统自然划分为两个 [BOUNDED CONTEXTS](1.md) 。
当两个组件需要不同技能或采用不同工具集实现时，这种划分尤为明显。
单向操作的转换更为简便。但仍可能出现问题，这取决于两个团队的政治关系。

<ins>**如果下游团队对变更拥有否决权，或者变更申请流程过于繁琐，就会束缚上游团队的自由发展。上游团队甚至可能因担心破坏下游系统而畏首畏尾。与此同时，下游团队则可能束手无策，完全受制于上游团队的工作优先级。**</ins>

下游需要上游提供的内容，但上游无需对下游交付物负责。预判哪些因素会影响其他团队需要额外付出大量精力，而人性本如此，时间压力又如此之大，唉……将团队间的关系制度化能让所有人的工作更轻松。流程可被设计成平衡两个用户群体的需求，并为下游所需功能安排开发计划。

在一个极限编程项目中，已经有一个机制可以专门用来做这件事：迭代计划过程。我们所要做的就是在计划过程中定义两个团队之间的关系。下游团队的代表可以像用户代表一样参与进来，加入他们的计划会议，直接与 “客户” 同事讨论他们所需任务的权衡。结果是为供应商团队制定一个迭代计划，其中包括下游团队最需要的任务，或者通过协议推迟任务，因此不会产生交付的期望。

若采用 XP 以外的流程，任何用于平衡不同用户需求的类似方法均可扩展以涵盖下游应用程序的需求。

因此：

<ins>**在两个团队之间建立清晰的客户/供应商关系。在规划会议中，让下游团队扮演客户角色，向上游团队提出需求。针对下游需求进行任务协商与预算分配，确保所有成员都清楚承诺内容和时间安排。**</ins>

<ins>**共同开发自动化验收测试，用于验证预期接口。将这些测试添加到上游团队的测试套件中，作为其持续集成的一部分运行。此项测试将使上游团队能够自由进行变更，无需担心对下游产生副作用。**</ins>

在迭代过程中，下游团队成员需要像传统客户那样随时响应上游开发人员的需求，解答疑问并协助解决问题。

<ins>自动化验收测试是客户关系中至关重要的一环。</ins>即便在最顺畅的合作项目中，即使客户能识别并传达其依赖关系，供应商也能勤勉地尝试沟通变更，若缺乏测试，意外仍会发生。这些意外将扰乱下游团队的工作，迫使上游团队承担计划外的紧急修复任务。相反，应由客户团队与供应商团队协作开发自动化验收测试，以验证其预期的接口。上游团队将把这些测试纳入标准测试套件运行。任何测试变更都需与对方团队沟通，因为修改测试意味着修改接口。

客户与供应商的关系也可能出现在不同公司间的项目之间，尤其当某个客户对供应商的业务至关重要时。<ins>尾巴摇狗：有影响力的客户提出的要求可能对上游项目的成功至关重要，但这些要求也可能扰乱上游项目的开发。双方都受益于需求响应流程的正式化，因为在外部关系中，成本效益权衡比在内部 IT 情境中更难把握。</ins>

<ins>该模式包含两个关键要素：</ins>

1. <ins>关系必须建立在客户与供应商的基础上，这意味着客户需求至高无上。由于下游团队并非唯一客户，不同客户的需求需在协商中取得平衡 —— 但这些需求始终是优先事项。</ins>这种情况与常见的弱势关系形成鲜明对比，后者往往导致下游团队不得不向上游团队乞求满足其需求。
2. <ins>必须建立一套自动化测试套件，使上游团队能够放心修改代码而不必担心破坏下游系统，同时让下游团队能够专注于自身工作，无需持续监控上游团队的动态。</ins>

在接力赛跑中，前跑者不能总是回头确认。他或她必须信任持棒者能精准完成交接，否则团队将不可避免地被拖慢速度。

#### 示例：收益分析与预订对比

让我们回到那个可靠的航运案例。公司组建了一支高度专业化的团队，负责分析所有流经企业的预订信息，以寻求收入最大化的方案。团队成员可能会发现船舶存在空余舱位，从而建议增加超额预订。他们也可能发现散货早早填满船舱，迫使公司拒绝更有利可图的特殊货物。这种情况下，他们可能会建议为这类货物预留舱位，或提高散货的运输价格。

为进行这项分析，他们运用了自主研发的复杂模型。在实施过程中，他们采用了配备构建分析模型工具的数据仓库。同时，他们需要从预订应用程序中获取大量信息。

从一开始就很清楚，这是两个 [BOUNDED CONTEXTS](1.md) ，因为它们使用不同的实现工具，最重要的是，它们采用不同的领域模型。它们之间应该建立怎样的关系？

[SHARED KERNEL](5.md) 可能看起来很合理，因为收益分析关注的是预订模型的一个子集，并且他们自己的模型在货物、价格等方面有一些重叠的概念。但是，当使用不同的实现技术时，[SHARED KERNEL](5.md) 就会变得困难。此外，收益分析团队的建模需求非常专业，他们会不断地调整模型并尝试替代方案。他们可能更适合将所需内容从预订 [CONTEXT](../glossary.md#context) 转换到自己的模型中。（另一方面，如果他们能够使用 [SHARED KERNEL](5.md) ，翻译的工作量将会轻很多。他们仍然需要重新实现模型，并将数据转换到新的实现中，但如果模型相同，迁移应该很简单。）

预订应用程序与收益分析没有依赖关系，因为没有自动调整策略的意图。人工专家将做出决策，并将其传达给所需的人和系统。因此，我们有一个上下游关系。下游需要的是：
1. 一些预订操作不需要的数据
2. 数据库方案 (schema) 的某种稳定性（或至少是可靠的变更通知）或一个导出工具

幸运的是，预订应用程序开发团队的项目经理积极主动地协助收益分析团队。这原本可能是个问题，因为实际负责日常预订业务的运营部门向不同的副总裁汇报，而负责收益分析的团队则向另一位副总裁汇报。但高层管理层高度重视收益管理，鉴于过去两个部门之间存在合作问题，他们将软件开发项目进行了重组，使两个团队的项目经理都向同一位负责人汇报。

因此，所有要求均已就绪，可启动`CUSTOMER/SUPPLIER DEVELOPMENT TEAMS`。

我曾在多个场景中目睹这种模式的演变：分析软件开发者与运维软件开发者之间存在着客户/供应商的关系。当上游团队成员将自身角色视为服务客户时，合作往往进展顺利。这种协作几乎总是以非正式方式组织，其成效基本取决于两位项目经理的个人关系。

在某个 XP 项目中，我目睹了这种关系的正式化：每次迭代时，下游团队的代表以客户身份参与 “planning game”，与更传统的客户代表（负责应用功能）共同商讨哪些任务应纳入迭代计划。该项目所在的小型公司里，最近的共同上级职位并不高，这种模式运作得相当顺利。

🌼🌼🌼

`CUSTOMER/SUPPLIER DEVELOPMENT TEAMS`如果在相同的管理下工作，更有可能取得成功，这样他们最终就会有共同的目标；或者当他们属于实际上具有这些角色的不同公司时，也能取得成功。当没有任何因素来激励上游团队时，情况就大不相同了……

#### ▶[下一节](7.md)
