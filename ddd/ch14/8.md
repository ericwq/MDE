## 反腐层

#### ▶[上一节](7.md)

![part 4.8](../img/part4.8.png)

新系统几乎总要与遗留系统或其他系统集成，而这些系统自有其模型体系。当连接设计精良的`BOUNDED CONTEXTS`与协作团队时，转换层可以简单甚至优雅。但当边界另一侧开始渗漏时，转换层可能转为防御性模式。

🌼🌼🌼

<ins>**当一个必须与另一个系统有大量接口的新系统正在构建时，关联这两个模型的难度最终可能会完全压倒新模型的本意，从而导致它被随意修改以类似于另一个系统的模型。遗留系统的模型通常比较薄弱，即使有一个例外的模型开发得很好，也可能不符合当前项目的需求。然而，集成可能具有很大的价值，有时它是绝对必要的。**</ins>

答案并非完全避免与其他系统的集成。我曾参与过一些项目，团队成员满怀热情地试图替换所有遗留系统，但这种做法一次承担的任务量实在太大。况且，与现有系统集成本身就是一种宝贵的复用形式。在大规模项目中，某个子系统往往需要与多个独立开发的子系统对接，而这些子系统对问题领域的映射方式各不相同。当基于不同模型的系统组合时，新系统为适应其他系统语义的需求，可能导致自身模型结构的扭曲。即便其他系统设计精良，其模型也与客户端模型存在差异。而现实中，其他系统往往设计欠佳。

与外部系统对接存在诸多障碍。例如，基础设施层必须提供与其他系统通信的途径，这些系统可能运行在不同平台或采用不同协议。其他系统的数据类型需要转换为本系统的数据类型。但人们常忽略的是：其他系统必然采用不同的概念域模型。

显然，若将某系统中的数据提取后在另一系统中误解，必然导致错误，甚至可能破坏数据库。然而即便如此，这个问题仍常悄然袭来，因为我们总以为在系统间传输的是原始数据，其含义明确无误且两端必然一致。这种假设通常是错误的。由于数据在各系统中的关联方式不同，往往会产生微妙却重要的含义差异。即便原始数据元素确实具有完全相同的含义，让系统间接口在如此低层级运作通常也是错误的。<ins>低层级接口剥夺了另一系统模型解释数据、约束其值与关系的能力，同时迫使新系统承担解释原始数据的负担，这些数据并非基于其自身模型定义的。</ins>

我们需要为遵循不同模型的各个部分提供转换机制，以确保模型不会因外来模型的未消化元素而遭到破坏。

因此：

<ins>**创建一个隔离层，为客户提供基于其自身领域模型的功能。该层通过现有接口与其他系统通信，几乎无需或完全无需修改其他系统。在内部，该层根据需要在两个模型之间进行双向转换。**</ins>

🌼🌼🌼

关于连接两个系统的机制讨论，可能会让人联想到数据在程序间或服务器间传输的问题。我稍后将探讨技术通信机制的整合方式。但这些细节不应与`ANTICORRUPTION LAYER`混淆——后者并非向其他系统发送消息的机制，而是将概念对象和操作从一种模型与协议转换为另一种的机制。

一个`ANTICORRUPTION LAYER`本身就可能成为复杂的软件组件。接下来我将概述创建该组件时需要考虑的一些设计要点。

#### ▶[下一节](9.md)
