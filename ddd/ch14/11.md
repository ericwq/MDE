## 公开的语言：`PUBLISHED LANGUAGE`

#### ▶[上一节](10.md)

两个 [BOUNDED CONTEXTS](1.md) 模型之间的转换需要一种通用语言。

🌼🌼🌼

当两个领域模型必须共存且信息需要在它们之间传递时，转换过程本身可能变得复杂且难以记录和理解。如果我们正在构建新系统，通常会认为新模型是最佳选择，因此倾向于直接将其作为转换目标。但有时我们需要增强旧系统集并尝试集成它们。在两个混乱的模型中选择其一，或许只是两害相权取其轻。

另一种情况：当企业需要相互交换信息时，该如何操作？不仅要求一方采用另一方的领域模型不切实际，对双方而言也未必可取。领域模型旨在为用户解决问题；此类模型可能包含某些特性，这些特性会不必要地增加与其他系统的通信复杂度。此外，若将某应用程序底层模型作为通信媒介，则该模型将无法自由调整以适应新需求，必须保持高度稳定性才能支撑持续的通信功能。

<ins>**直接在现有领域模型之间进行数据转换可能并非良策。这些模型可能过于复杂或结构不良，且很可能缺乏文档记录。若将其用作数据交换语言，该模型本质上将被固化，无法响应新的开发需求。**</ins>

[OPEN HOST SERVICE](10.md) 采用标准化协议实现多方集成。它运用领域模型促进系统间交互，即使这些系统内部未必使用该模型。在此我们更进一步：发布该语言规范，或寻找已发布的规范。我所说的 *发布* 只是指该语言可以方便地被可能有兴趣使用它的群体获取，并且有足够的文档，以便不同的理解能够兼容。

最近，电子商务领域对一项新技术非常感兴趣：可扩展标记语言（XML）承诺能够使数据交换变得更加容易。XML 的一个非常有价值的特性是，通过文档类型定义（DTD）或 XML schema，XML 允许正式定义一个专门的领域语言，从而将数据转换为该语言。行业组织已经开始成立，旨在为其行业定义一个统一的 DTD 标准，这样，例如化学公式信息或基因编码就可以在多个参与方之间进行交流。本质上，这些组织正在以语言定义的形式创建一个共享的领域模型。

因此：

<ins>**使用一种文档完善的共享语言，能够以通用的交流媒介表达必要的领域信息，并在需要时进行相应的翻译。**</ins>

该语言无需从零创建。多年前，我曾受雇于一家公司，其软件产品采用 Smalltalk 编写，并使用 DB2 存储数据。该公司希望获得灵活分发软件的能力，使没有 DB2 许可证的用户也能使用，因此委托我开发一个连接 Btrieve 的接口，这是一款更轻量级的数据库引擎，拥有免费的运行时分发许可证。Btrieve 虽非完全关系型数据库，但客户仅使用了 DB2 功能的极小部分，且需求恰好处于两者功能的最低交集。该公司开发人员已在 DB2 基础上构建了若干基于对象存储的抽象层，我决定将这些成果作为 Btrieve 组件的接口基础。

这种方法确实奏效了。软件与客户系统实现了无缝集成。然而，由于客户设计中缺乏对持久化对象抽象概念的正式规范或文档说明，我不得不投入大量精力来厘清新组件的需求。此外，该组件几乎没有机会被复用以将其他应用程序从 DB2 迁移至 Btrieve。而新软件进一步固化了公司的持久化模型，使得重构持久化对象模型变得更加困难。

一种更好的方法可能是确定公司正在使用的 DB2 接口的子集，然后仅支持该子集。DB2 的接口由 SQL 和一些专有协议组成。尽管它非常复杂，但接口有严格的规范并且文档完善。这种复杂性本可以通过因为仅使用接口的一小部分而得到缓解。如果开发了一个可以模拟所需 DB2 接口子集的组件，只需确定该子集，就可以非常有效地为开发人员提供文档。这一组件集成的应用程序已经知道如何与 DB2 交互，因此几乎不需要额外工作。未来对持久化层的重新设计将只受限于使用 DB2 子集，就像增强之前一样。

<ins>DB2 接口是`PUBLISHED LANGUAGE`的一个示例。在此情况下，两个模型虽不属于业务领域，但所有原则依然适用。由于协作中的其中一个模型本身已是`PUBLISHED LANGUAGE`，因此无需引入第三种语言。</ins>

#### 示例：化学领域的`PUBLISHED LANGUAGE`

在工业和学术界，无数程序被用于编目、分析和处理化学公式。数据交换始终困难重重，因为几乎每个程序都采用不同的领域模型来表示化学结构。当然，其中大多数程序是用诸如 FORTRAN 等语言编写的，这些语言本身就无法充分表达领域模型。每当需要共享数据时，用户都必须深入解析对方系统的数据库细节，并设计相应的转换方案。

化学标记语言（CML）应运而生，作为 XML 的一种方言，旨在成为该领域的通用交换语言，由代表学术界和工业界的团体开发并管理
（ [Murray-Rust et al. 1995](../references.md#murray-rust-1995) ）。

化学信息极其复杂多样，且随着新发现不断变化。因此他们开发了一种语言，能够描述基础信息，例如有机分子和无机分子的化学式、蛋白质序列、光谱或物理量。

既然该语言已正式发布，便可开发出此前根本不值得投入精力编写的工具，因为它们原本仅适用于单一数据库。例如，一款名为 JUMBO 浏览器的 Java 应用程序应运而生，它能将存储于 CML 中的化学结构转化为图形化视图。因此，只要将数据转换为 CML 格式，您就能使用这类可视化工具。

事实上，通过采用 XML 这种 “公开的元语言”，CML 获得了双重优势：人们对 XML 的熟悉程度降低了 CML 的学习门槛；各类现成的工具（如解析器）简化了实现过程；而大量关于 XML 处理各方面的书籍则为文档编写提供了有力支持。

这里展示了 CML 的一小段代码示例。对于我这样的外行人，它仅能勉强看懂，但其原理清晰可辨。
```xml
<CML.ARR ID="array3" EL.TYPE=FLOAT NAME="ATOMIC ORBITAL ELECTRON POPULATIONS"
SIZE=30 GLO.ENT=CML.THE.AOEPOPS>
  1.17947 0.95091 0.97175 1.00000 1.17947 0.95090 0.97174 1.00000
  1.17946 0.98215 0.94049 1.00000 1.17946 0.95091 0.97174 1.00000
  1.17946 0.95091 0.97174 1.00000 1.17946 0.98215 0.94049 1.00000
  0.89789 0.89790 0.89789 0.89789 0.89790 0.89788
</CML.ARR>
```
🌼🌼🌼

#### ▶[下一节](12.md)
