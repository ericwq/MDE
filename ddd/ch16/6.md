## 结构应该有多严格？

#### ▶[上一节](5.md)

本章讨论的大规模结构模式范围从非常宽松的 [SYSTEM METAPHOR](2.md) 到严格的 [PLUGGABLE COMPONENT FRAMEWORK](5.md) 。当然，也有其他结构是可能的，即使在一个通用的结构模式内，关于规则的严格程度也有很多选择。

例如，[RESPONSIBILITY LAYERS](3.md) 规定了一种对模型概念及其依赖关系的分解方式，但你也可以添加规则来指定层之间的通信模式。

考虑一个制造工厂，软件会指导每个零件进入特定的机器，并根据某种工艺进行加工。正确的工艺由策略层下达，并在操作层执行。但是，在工厂车间不可避免地会出现错误。实际情况不会完全符合软件的规则。现在，操作层必须反映实际情况，这意味着当零件偶尔放入错误的机器时，这一信息必须无条件地被接受。某种方式下，这种特殊情况需要传达给上层。决策层可以使用其他策略来纠正这种情况，例如通过将零件重新引导到修复流程或报废它。然而，操作层对上层一无所知。通信必须以一种不会在下层和上层之间产生双向依赖的方式进行。

通常，这种信号传递是通过某种事件机制来完成的。当操作对象的状态发生变化时，它们会生成事件。策略层对象会监听来自下层的感兴趣事件。当发生违反规则的事件时，该规则会执行一个操作（规则定义的一部分），以做出适当的响应，或者它可能会生成一个事件，以供更高层使用。

在银行业的例子中，资产的价值会发生变化（操作），从而改变投资组合各部分的价值。当这些价值超过投资组合分配限制（政策）时，可能会提醒交易员，交易员可以买入或卖出资产以恢复平衡。

我们可以逐个案例解决这个问题，也可以为特定层级对象的交互制定统一规范供所有人遵循。更严格的结构能提升一致性，使设计更易理解。若结构契合，规则往往能引导开发者走向优质设计，分散的组件也更可能完美融合。

另一方面，这些限制可能剥夺开发人员所需的灵活性。在异构系统中，某些特定的通信路径可能难以在 [BOUNDED CONTEXTS](../ch14/1.md) 之间实现，尤其是在采用不同实现技术的场景下。

<ins>因此必须抵制构建框架、强制规范大规模结构实现的诱惑。大规模结构最重要的贡献在于概念一致性，以及对领域本身的洞察。每条结构规则都应让开发更轻松。</ins>

#### ▶[下一节](7.md)
