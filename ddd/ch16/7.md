## 重构以适配结构

#### ▶[上一节](6.md)

在行业正摆脱过度前期设计的时代，有人会将大规模结构视为瀑布式架构的陈腐遗风。但事实上，唯有通过对领域与问题的深刻理解，才能找到切实可行的结构方案，而实现这种理解的有效途径正是迭代开发过程。

<ins>致力于 [EVOLVING ORDER](1.md) 的团队必须在项目生命周期中无畏地重新思考大规模架构。团队不应被早期构思的架构所束缚，那时团队对领域和需求尚不透彻。</ins>

遗憾的是，这种演进意味着最终的结构在初期无法实现，因此你必须在开发过程中逐步重构以实现它。这可能代价高昂且困难重重，但却是必要的。存在一些通用方法来控制成本并最大化收益。

### 极简主义

控制成本的关键之一在于保持结构简单轻量。不必追求面面俱到，只需解决最关键的问题，其余部分可根据具体情况灵活处理。

初期采用松散结构颇有裨益，例如 [SYSTEM METAPHOR](2.md) 或若干 [RESPONSIBILITY LAYERS](3.md) 。即便最简的松散结构，也能提供轻量级指导原则，有效避免混乱局面。

### 沟通与自律

整个团队在新的开发和重构过程中必须遵循结构规范。为此，团队全体成员必须理解该结构体系。相关术语与关联关系必须纳入 [UBIQUITOUS LANGUAGE](../ch2/1.md) 体系。

大规模结构能为项目提供处理系统全局的词汇库，使不同成员能独立做出协调一致的决策。<ins>但由于多数大规模结构仅是松散的概念性指导，团队必须保持自律。</ins>

若缺乏众多参与者的持续遵循，结构往往会逐渐瓦解。结构与模型或实现细节部分的关系通常在代码中并不明确，功能测试也不依赖于结构。此外，结构往往具有抽象性，因此在大团队（或多个团队）中难以保持应用的一致性。

多数团队内部的沟通交流不足以维持系统中大型结构的一致性。关键在于将其纳入项目的 [UBIQUITOUS LANGUAGE](../ch2/1.md) ，并要求所有成员持续践行这种语言。

### 重构带来灵活设计

其次，任何结构变更都可能引发大量重构工作。随着系统复杂度提升和理解加深，结构本身也在不断演进。每次结构变更都要求 *整个系统遵循新秩序进行调整* ，显然这需要投入大量精力。

这其实没听起来那么糟糕。我发现具有大规模结构的设计通常比没有结构的设计更容易改造。即使在从一种结构转换为另一种结构时，比如从 [METAPHOR](2.md) 转换为 [LAYERS](3.md)，似乎也是如此。我无法完全解释这种现象。部分原因在于：当你能理解现有布局时，重组工作自然更轻松，而预先存在的结构恰恰提供了这种便利。另一部分原因则在于，维持早期结构所需的严谨性已渗透到系统的每个角落。但我认为还有更深层的因素，那些曾经历过 *两种* 结构的系统，其改造难度反而 *更低* 。

一件新的皮夹克很硬、不舒服，但穿第一天后，肘部活动了几次，开始变得容易弯曲。再穿几次后，肩部也松动了，穿上夹克更容易了。经过几个月的穿着，皮革变得柔软，穿着舒适，行动自如。<ins>对经过良好变换反复改造的模型来说，也是如此。不断增长的知识被嵌入到模型中， *主要的变化轴线已经被识别并变得灵活* ，而稳定的方面则被简化。底层领域的更广泛 [CONCEPTUAL CONTOURS](../ch10/4.md) 正在模型结构中显现出来。</ins>

### 提炼减轻负担

另一个应施加于模型的关键力量是持续提炼。这能从多方面降低结构变更的难度。首先，通过从 [CORE DOMAIN](../ch15/1.md) 中移除机制、[GENERIC SUBDOMAINS](../ch15/3.md) 及其他支撑结构，待重组的内容本身就会减少。

在可能的情况下，这些辅助元素应以简洁的方式定义，使其能融入大规模结构。例如，在 [RESPONSIBILITY LAYERS](3.md) 系统中，可将 [GENERIC SUBDOMAINS](../ch15/3.md) 定义为仅属于单一层级。对于 [PLUGGABLE COMPONENTS](5.md) ，[GENERIC SUBDOMAINS](../ch15/3.md) 可由单一组件完全拥有，也可作为相关组件集的 [SHARED KERNEL](../ch14/5.md) 。这些辅助元素可能需要重构以确定其在结构中的定位；但它们独立于 [CORE DOMAIN](../ch15/1.md) 移动，且聚焦范围更窄，这使得重构更为简便。最终它们的重要性较低，因此精炼程度的影响也较小。

提炼与重构以获得更深层洞察的原则，同样适用于大规模结构本身。例如，分层结构最初可能基于对领域表层的理解而设定；随后逐渐被更深层的抽象所取代，这些抽象能体现系统的核心职责。这种锋利的清晰度使人们能够透视设计本质，这既是目标，也是手段的一部分，因为它使大规模系统操作变得更轻松、更安全。

#### ▶[下一节](../ch17/0.md)
