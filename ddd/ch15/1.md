## 核心领域：`CORE DOMAIN`

#### ▶[上一节](0.md)

![part 4.11](../img/part4.11.png)

<ins> **在设计大型系统时，有许多相互作用的组件，它们既复杂又对成功至关重要，以至于领域模型的本质，真正的业务资产，可能会被掩盖和忽视。** </ins>

难以理解的系统难以改变。变更的效果难以预见。开发者一旦走出熟悉的领域就会迷失方向。（新成员加入团队时尤其如此，但即使是资深成员，若代码不够清晰且组织混乱，同样会陷入困境。）这迫使人们走向专业化。当开发者将工作局限于特定模块时，知识转移进一步受阻。工作模块化导致系统整合受阻，任务分配的灵活性丧失。当开发者未能察觉某项功能已在别处实现时，重复劳动便随之滋生，使系统愈发复杂。

难以理解的设计往往会带来诸多后果，但还有另一种风险同样严重，即丧失对领域全局的把握：

<ins>**残酷的现实是，设计中的各个部分不可能都得到同等程度的打磨。必须设定优先级。要使领域模型成为资产，其关键核心必须精炼且充分利用，以构建应用程序功能。但稀缺的高技能开发者往往倾向于投身技术基础设施或那些无需专业领域知识即可理解的、界定清晰的领域问题。**</ins>

<ins>系统中的这类组件对计算机科学家颇具吸引力，被认为能培养可迁移的专业技能并为简历增添亮点。而真正体现应用差异性、构成商业价值的核心部分，即模型中的专业化核心模块，最终往往由技术能力较弱的开发人员负责。他们与 DBA 协作创建数据 schema 后，便逐项编写功能代码，完全未调用模型中的任何概念化能力。</ins>

<ins>软件该部分的设计或实现存在缺陷，将导致应用程序永远无法为用户提供令人心动的体验，无论技术架构多么完善，配套功能多么出色。当项目缺乏清晰的整体设计蓝图及各部分相对重要性的认知时，这种隐蔽问题便会悄然滋生。</ins>

我参与过的最成功的项目之一，最初就曾深受这种症结困扰。该项目旨在开发一套极其复杂的银团贷款系统。多数顶尖人才正愉快地投入数据库映射层和消息接口的开发工作，而业务模型却交由刚接触面向对象技术的开发人员负责。

唯一的例外是一位经验丰富的对象开发者，他在处理领域问题时设计了一种方法，能够为任何长寿命领域对象附加注释。这些注释经过组织后，交易员可以查看自己或他人为某些历史决策记录的依据。他还构建了一个优雅的用户界面，让用户能够直观地访问注释模型的灵活功能。

这些功能实用且设计精良，最终投入了生产环境。

遗憾的是，它们只是边缘功能。这位才华横溢的开发者将自己独特而通用的注释方式建模化，以简洁的方式实现后交付给用户使用。与此同时，另一位能力不足的开发者却将关键的 “贷款” 模块改造成了一团令人费解的混乱代码，项目险些因此陷入无法挽回的境地。

规划流程必须将资源导向模型与设计中最关键的节点。为此，在规划与开发过程中，所有成员都必须识别并理解这些节点。

模型中那些独特且对目标应用核心功能至关重要的部分构成 [CORE DOMAIN](../glossary.md#core-domain) 。[CORE DOMAIN](../glossary.md#core-domain) 正是系统中应重点增值的环节。

因此：

<ins>**将模型精简至核心。找出 [CORE DOMAIN](../glossary.md#core-domain) ，并提供一种方法使其能从海量辅助模型和代码中轻松区分出来。让最具价值和最专业的概念清晰凸显。使`CORE`保持精简。**</ins>

<ins>**将顶尖人才投入 [CORE DOMAIN](../glossary.md#core-domain) ，并据此招聘。在`CORE`倾注心力，以构建深度模型并发展灵活设计，充分实现系统愿景。对其他部分的任何投入，都需证明其如何支撑提炼后的`CORE`。**</ins>

提炼 [CORE DOMAIN](../glossary.md#core-domain) 并非易事，但它确实能带来一些轻松的决策。你会投入大量精力让`CORE`独具特色，同时将其余设计保持在实用的通用性范围内。若需将设计中的某个方面作为竞争优势保密，那必然是 [CORE DOMAIN](../glossary.md#core-domain) 。无需浪费精力掩盖其余部分。每当因时间限制需在两个理想的重构方案间抉择时，应优先选择对 [CORE DOMAIN](../glossary.md#core-domain) 影响最显著的方案。

🌼🌼🌼

本章介绍的模式使 [CORE DOMAIN](../glossary.md#core-domain) 更易于理解、使用和修改。

### 选择`CORE`

我们关注模型中那些专门用于表示业务领域、解决业务问题的部分。

我们正在研究模型中那些专门用于表示您的业务领域并解决您的业务问题的部分。

您选择的 [CORE DOMAIN](../glossary.md#core-domain) 取决于您的视角。例如，许多应用程序需要一个通用货币模型，能够表示各种货币及其汇率和兑换关系。另一方面，支持货币交易的应用程序可能需要更复杂的货币模型，这会被视为`CORE`的一部分。即便如此，该货币模型中仍可能存在高度通用的部分。随着经验积累对领域理解的深化，可通过持续提炼过程分离通用货币概念，仅将模型的专业化部分保留在 [CORE DOMAIN](../glossary.md#core-domain) 中。

在航运应用中，`CORE`可能指货物如何进行装船拼箱的模型、集装箱交接时责任如何转移的模型，或是特定集装箱如何通过多种运输方式抵达目的地的模型。在投资银行领域，`CORE`可能包含资产在受让人和参与者之间进行银团贷款的模型。

一个应用程序的 [CORE DOMAIN](../glossary.md#core-domain) ，可能是另一个应用程序的通用支持组件。然而，在整个项目范围内，通常在整个公司范围内，都可以定义一个统一的`CORE`。如同设计中的其他部分，[CORE DOMAIN](../glossary.md#core-domain) 的识别应通过迭代逐步完善。特定关系集的重要性可能不会立即显现，那些最初看似核心的对象，最终可能被发现只是扮演着辅助角色。

以下各节的讨论，特别是`GENERIC SUBDOMAINS`部分，将为这些决策提供更多指导原则。

### 谁来完成这项工作？

<ins>项目团队中技术能力最强的成员往往缺乏领域知识。这限制了他们的价值，并强化了将他们分配到支持性组件的倾向，从而形成恶性循环，知识匮乏使他们远离能积累领域知识的工作。</ins>

要打破这种循环，关键在于组建一支由长期投入且有志成为领域知识库的优秀开发者，与一位或多位深谙业务的领域专家共同组成的团队。当认真对待时，领域设计既充满趣味又极具技术挑战性，而开发者中不乏认同这种观点的人。

通常不建议为构建 [CORE DOMAIN](../glossary.md#core-domain) 的具体实施环节临时聘请外部设计专家，因为团队需要积累领域知识，而临时成员如同桶上的漏洞。另一方面，担任教学/指导角色的专家却能发挥巨大价值——他们既能帮助团队建立领域设计能力，又能促进团队运用那些成员尚未掌握的复杂设计原则。

出于类似原因，[CORE DOMAIN](../glossary.md#core-domain) 不太可能被购买。业界曾尝试构建特定行业的模型框架，显著的例子包括半导体行业联盟 SEMATECH 为半导体制造自动化开发的 CIM 框架，以及 IBM 面向广泛业务的 “San Francisco” 框架。尽管这一构想极具吸引力，但迄今成效尚不显著，除作为促进数据交换的 [PUBLISHED LANGUAGE](../ch14/11.md) （参见 [第 14 章](../ch14/0.md) ）外。专著《Domain-Specific Application Frameworks》（ [Fayad and Johnson 2000](../references.md#fayad-2000) ）对此领域现状进行了综述。随着技术发展，未来或将涌现更具实用性的框架。

即便如此，谨慎行事还有更根本的原因：定制软件的最大价值在于对 [CORE DOMAIN](../glossary.md#core-domain) 的完全掌控。设计精良的框架或许能提供高级抽象层，供你根据需求进行定制化开发。它或许能让你免于开发通用组件，从而专注于`CORE`部分。但若其限制超出此范畴，则可能出现三种情形：

1. 您正在失去一项关键的软件资产。请在 [CORE DOMAIN](../glossary.md#core-domain) 中减少限制性框架的使用。

2. 框架所覆盖的范围并不如您想象中重要。请将 [CORE DOMAIN](../glossary.md#core-domain) 的边界重新划定至模型中真正具有独特性的部分。

3. 您的 [CORE DOMAIN](../glossary.md#core-domain) 并无特殊需求。请考虑采用风险较低的解决方案，例如购买可与现有应用程序集成的软件。

<ins>无论采取何种方式，打造出色的软件终究要依靠稳定的团队积累专业知识，并将这些知识转化为丰富的模型。没有捷径可走，也没有灵丹妙药。</ins>

#### ▶[下一节](2.md)
