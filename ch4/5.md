## 4.5 软件工厂
*软件工厂* (Software Factories) 一词由微软公司提出，并在杰克-格林菲尔德（Jack Greenfield）和基思-肖特（Keith Short）的同名著作 [GS04](../ref.md#gs04) 中作了大量描述。简而言之，软件工厂是一种集成开发环境，专门为高效开发特定类型的应用程序（如特定领域的应用程序）而配置。经过配置的 IDE 可以尽可能简单地使用特定领域的模型、DSL、框架和模式。因此，“软件工厂” 的概念是软件开发 “从手工到制造” 的工业化。一些人将软件工厂描述为 “用微软的方法来做产品线” -- 有关产品线工程的一些细节，请参见第 [13.5](../ch13/5.md) 节。虽然产品线方面的说法肯定是正确的，但微软正在努力确保这种方法不会被认为是微软独有的概念。例如，在 OOPSLA 2005 大会 [SFW05](../ref.md#sfw05) 上举办的相关研讨会就确保了微软以外的人员参与到项目委员会中来。然而，公众的看法仍然是，它在很大程度上是以微软为中心的。

由于软件工厂的概念着眼于完整的产品线工程过程，它的范围比 “仅仅” 模型驱动软件开发要宽泛得多，尽管 DSL、建模和转换是其中的一个重要组成部分。因此，我们将首先探讨整体方法，然后再探讨 DSL 的具体方面。

### 4.5.1 软件工厂模式
软件工厂模式 (Software Factory Schema) 可以说是整个概念的基石。它定义了构建相应系统时有用和必要的视角 (viewpoints) 。例如，一个企业系统可能包含以下视角：
- 呈现，包括表单布局和工作流程 
- 组件结构和业务数据模型
- 持久性映射
- 部署视角

对于每一种视角，模式都会确定核心工件，以及制作这些工件的最有效方法。这些方法包括手动编程、以特定方式使用模式、使用经过扩展或配置的框架，以及设计并随后使用 DSL，然后生成代码或配置文件等各种工件。这些视角可以相互依赖，从而形成一个有向图 -- 换句话说，部署视角取决于组件结构：没有定义的东西是无法部署的。

因此，模式是一个概念框架或 “配方” ，可根据抽象级别或其在架构或开发流程中的位置，将各自应用领域中的关注点分开。模式还能确定模式所涉及领域中各应用的共性和差异。

### 4.5.2 软件工厂模板
模式基本上是一个结构化文档。然而，为了能够为相应类型的应用程序配置开发环境（这种工具配置是软件工厂的最终目标），我们必须使所有这些 “工具可用” 。这种 IDE 配置被称为软件工厂模板 (Software Factory Template) 。它可以加载到 IDE （通常是 Visual Studio）中，为开发相应类型的应用程序配置 IDE。例如
- 提供必要的框架或库。
- 提供特定类型的项目，这些项目的结构适用于软件工厂。
- 提供构建脚本。
- 使用新的 DSL 编辑器和转换器扩展 IDE。

首先，我们还需要有必要的工具来构建其中一些工件。构建框架不需要IDE 提供任何特定工具，但 DSL 则不同。我们需要定义元模型、具体语法和转换的工具。

### 4.5.3 DSL 的作用及其与 MDSD 的关系
到此为止，我们已经研究了软件工厂提出的软件（产品线）开发的一般方法。从这种方法来看，直接将其与 MDSD 进行比较显然是没有意义的。不过，我们可以将软件工厂中模型的使用以及相应基础设施的构建与 MDSD 进行比较。这就是本节的目标。

一般来说，软件工厂使用第 [4.1](../ch4/1.md) 节中定义的概念，没有大的改动或重命名。特定领域语言用于构建模型。这些语言通常（但不一定）是图形化的。Visual Studio 提供了定义元模型以及具体语法和编辑器的工具 -- 请记住它的工具焦点。微软的基础架构没有使用任何 OMG 标准： DSL 不是基于 UML 的，元模型也不是基于 MOF，而是使用 MDF，即用于此目的的元数据框架。

从应用程序开发人员的角度来看，模型是开发项目中的一级工件，编辑器和转换可无缝集成到 IDE 中。从基础架构开发人员的角度来看，元模型、编辑器定义和转换是一级工件，构建它们的工具也无缝集成到 IDE 中。微软还一贯遵循不修改生成代码的方法。如第 [8.3.1](../ch8/3.md#831-生成代码与人工部分的显式集成) 节所述，可以使用模式进行集成。在 .NET 环境中，这些模式特别添加了部分类的概念，这意味着一个类的定义可以分布在许多文件中，而这些文件中有些是生成的，有些是手写的。
