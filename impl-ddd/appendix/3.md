## Lambda 语法

#### ▶[上一节](2.md)

如果你的编程语言支持 Lambda 表达式，就可以通过避免重复的`Event Stream`管理，让原本冗余的代码变得更加简洁。
为了演示这一点，我们在`Application Service`中引入一个辅助方法：

```csharp
public class CustomerApplicationService
{
  ...
  public void Update(CustomerId id, Action<Customer> execute)
  {
    EventStream eventStream = _eventStore.LoadEventStream(id);
    Customer customer = new Customer(eventStream.Events);
    execute(customer);
    _eventStore.AppendToStream(
      id, eventStream.Version, customer.Changes);
  }
  ...
}
```

在该方法中，参数 Action\<Customer\> execute 引用了一个可对任意 Customer 实例进行操作的匿名函数（C# 委托）。
Lambda 表达式的简洁性可从传递给 Update() 方法的参数中体现：

```csharp
public class CustomerApplicationService
{
  ...
  public void When(LockCustomer c)
  {
    Update(c.Id, customer => customer.LockCustomer(c.Reason));
  }
  ...
}
```

实际上，C# 编译器会生成与以下代码类似的内容，以实现该 Lambda 表达式的意图：

```csharp
public class AnonymousClass_X
{
    public string Reason;
    public void Execute(Customer customer);
    {
       Customer.LockCustomer(Reason);
    }
}

public delegate void Action<T>(T argument);

public void When(LockCustomer c)
{
  var x = new AnonymousClass_X();
  x.Reason = c.Reason
  Update(c.Id, new Action<Customer>(customer => x.Execute(customer));
}
```

由于生成的函数以 Customer 实例作为参数，它实际上可以用来捕获代码中的行为，并在不同的 Customer 实例上多次执行。
下一节将重点展示使用 Lambda 的强大之处。

#### ▶[下一节](4.md)
