## 采访成功的首席信息官

#### ▶[上一节](0.md)

为阐明本章探讨的各类架构影响因素为何被采用，我们将穿越十年时光，采访 SaaSOvation 公司的首席信息官。尽管该公司起步时规模有限，但架构决策却助力其在每个发展阶段取得成功。现在让我们收听由 Anchor Maria Finance-Ilmundo 主持的 *TechMoney* 节目……

**Maria**：今晚，我将独家专访大获成功的 SaaSOvation 公司首席信息官 Mitchell Williams 。我们继续推出 “了解你的架构风格” 系列节目，今晚聚焦于如何通过选择正确的架构实现持久成功。欢迎来到节目，Mitchell，感谢您的参与。

**Mitchell**：Maria，很高兴再次来到这里，每次都很愉快。

**Maria**：你能给我们讲讲你们最初做出的一些架构决策，以及原因吗？

**Mitchell**：当然可以。信不信由你，我们实际上最初是围绕桌面部署来规划我们的项目的。我们的团队设计了桌面应用程序以持久化到中央数据库。他们为这种方法选择了`Layers Architecture`。

**Maria**：那有道理吗？

**Mitchell**：嗯，我们觉得有道理，特别是因为我们只处理单一的应用层加上中央数据库。对于简单的客户端-服务器模式来说，这会很适合我们。

**Maria**：但形势很快逆转了，对吧？

**Mitchell**：确实如此。我们与商业伙伴联手，决定推进 SaaS 订阅模式。我们为此寻求了大额融资并成功到位。
我们决定将敏捷项目管理应用暂时搁置，优先开发协作工具套件。此举有双重效益：既能抢占快速增长的协作市场，又能为项目管理应用提供天然的功能扩展，比如在软件开发项目交付环节实现协作。

**Maria**：有意思。听起来很接地气。这些决策最终引导你们走向了何方？

**Mitchell**：<ins>随着软件复杂性的增加，我们需要通过引入单元测试和功能测试工具来管理质量。为此，我们有点颠倒了层的概念，引入了依赖反转原则（DIP）。这很重要，因为团队可以通过替换掉 UI 和基础设施层来轻松测试，并专注于测试应用层和领域层。事实上，我们可以独立开发 UI，并在一段时间内延迟关于持久化技术的决策。而且，这实际上并不是与层的概念相差很远。团队非常适应这种方式。</ins>

Maria：哇，要更换用户界面和持久化！这听起来很冒险。这有多难？

Mitchell：嗯，其实不算太难。事实证明，我们使用 DDD 的战术模式完全没有给我们增加困难。由于我们采用了`Aggregate`模式和`Repositories`模式，我们可以在`Repository`接口背后使用内存持久化进行开发，然后在有时间权衡选项后再切换为实际的持久化机制。

**Maria**：哇哦。

**Mitchell**：完全正确。

**Maria**：然后呢？

**Mitchell**：砰。事情就这样启动了。我们推出了 CollabOvation 和 ProjectOvation，连续几个季度都实现了盈利。

**Maria**：叮当响。

**Mitchell**：说得对。后来我们决定在桌面浏览器之外支持移动设备，毕竟移动端爆发式增长席卷了整个市场。为此我们采用了 REST 架构。用户开始要求联合身份认证和安全功能，以及更复杂的项目与时间资源管理工具。接着新投资者又要求在他们偏好的商业智能仪表盘上查看报告。

**Maria**：太棒了。原来不仅移动端在爆发式增长。说说你们如何应对这些挑战吧。

**Mitchell**：<ins>团队认为迁移到`Hexagonal Architecture`是处理这些新增功能的明智选择。他们发现`Ports`与`Adapters`模式能让他们几乎随时随地添加新型客户端。新增输出`Ports`类型同样如此，比如创新的持久化机制（如 NoSQL ）和消息传递能力。这一切都指向同一个方向：云。</ins>

**Maria**：所以你对那些调整很有信心？

**Mitchell**：绝对有。

**Maria**：非常有。如果你能顶住所有压力，那很可能意味着你做出了明智的选择，这些选择让你能够发挥出更大的潜力。

**Mitchell**：正是如此。当时我们每月新增数百名租户。我们还专门开发了服务，将企业旧版协作工具中的数据迁移至云端。<ins>团队认为采用面向服务架构（SOA）能通过 Mule’s Collection Aggregator 高效整合这些数据。该方案既能部署在服务边界，又能兼容`Hexagonal Architecture`。</ins>

**Maria**：啊，所以你们引入 SOA 并非因为它听起来很酷，而是在合理场景下加以运用。太完美了。整个行业很少见到如此明智的决策。

**Mitchell**：是的，Maria，这正是我们始终坚持的方法。它就是我们成功的蓝图。例如，我们后来添加了缺陷追踪软件 TrackOvation，并与 ProjectOvation 实现了集成。随着 ProjectOvation 功能的扩展，其用户界面也变得越来越复杂。系统中产品负责人的所有 Scrum 产品和缺陷仪表板，会随每次应用程序命令及对应事件实时更新。由于不同租户的产品负责人偏好视图各异，这使得仪表板变得更加复杂。当然，我们还必须支持移动设备。团队曾探讨过引入 CQRS 架构模式的可行性。

**Maria**：CQRS？得了吧 Mitchell，这概念可够高深的。那算不算我们无法预知结果的不确定因素之一？要不要直接跳板走人？

**Mitchell**：不，其实不然。<ins>当团队找到合理理由采用 CQRS 来缓解命令与查询领域间的摩擦后，他们就全速推进，再也没有回头。</ins>

**Maria**：正是。那不正是你们订阅用户开始要求需要分布式处理的功能的时候吗？

**Mitchell**：<ins>没错；若这次处理不当，我们很快就会被复杂性淹没。某些功能需要经过一系列分布式流程才能输出结果。ProjectOvation 团队绝不让用户为这些可能耗时的任务等待，更不会冒超时风险。他们引入了完整的`Event-Driven Architecture`，采用经典的`Pipes`与`Filters`模式来管理这些流程。</ins>

**Maria**：但你的复杂性之旅并未就此结束，对吧？那段经历有多艰难？

**Mitchell**：哈哈。不不，那似乎永远不会发生。不过，当你拥有一个聪明的团队时，复杂性之旅就像公园散步般轻松。实际上，`Event-Driven Architecture`简化了不断扩展的系统套件中的许多领域。

**Maria**：确实如此。继续说。那可是个绝佳机会。现在要讲到我最喜欢的部分了。你知道……\[眼中闪着 $$$ 的光\]

**Mitchell**：我们的架构让我们得以如此快速地扩展规模并高效管理变革，以至于 RoaringCloud 收购 SaaSOvation 时……嗯……具体细节都已公开记录在案。

**Maria**：我得说，而且是公开的。按每股 50 美元计算，这相当于约 30 亿美元的公开记录。

**Mitchell**：对财务数据记得真清楚！这确实是推动整合成功的重大动力。<ins>他们带来了大量新用户，用户基数甚至开始对 ProjectOvation 的基础设施造成压力。现在必须对`Pipes`和`Filters`进行分布式并行化处理，这需要引入长时运行的进程，有时称为`Sagas`。</ins>

**Maria**：不错。你能断言那很有趣吗？

**Mitchell**：确实有趣，但更重要的是它势在必行。

**Maria**：而且这乐趣似乎永无止境。接下来发生的事，恐怕是你漫长成功故事中最出人意料甚至令人震惊的篇章之一。

**Mitchell**：你懂的。由于海量订阅应用和数百万用户，RoaringCloud 在市场上形成垄断地位后，政府开始关注并着手监管该行业。新法规要求 RoaringCloud 必须追踪项目中的每项变更。实际上，将合规处理自然融入领域模型的最佳方案就是采用`Event Sourcing`。

**Maria**：天哪，你当时真沉着。这太疯狂了，我是说真的，真的疯狂。

**Mitchell**：这其实是个疯狂的好问题，真的。

**Maria**：令我惊叹的是，这些年来你们应用程序的核心始终基于 DDD 软件模型。但显然 DDD 并未给你们带来困扰，你们似乎从未因此遭遇困境。

**Mitchell**：事实恰恰相反。我们坚信正是因为早期选择了 DDD，并花时间深入理解它，才得以从容应对那些无法回避 ——也不愿回避—— 的业务场景。

**Maria**：嗯，正如我常说的，“叮当响！” 再次感谢你，Mitchell。在 "了解你的架构风格" 节目中，我们了解到如何通过选择正确的架构实现持久成功。

**Mitchell**：不客气，Maria。感谢您的邀请。

这段内容虽有些古怪，却颇具启发性。它展示了后续章节探讨的架构理念如何与 DDD 结合运用，以及如何在恰当时机引入每种理念。

#### ▶[下一节](2.md)
